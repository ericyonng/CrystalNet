syntax = "proto3";
package CRYSTAL_NET.service;

import "com_book.proto";


// 按照权限大小排
message RoleType
{
    enum ENUMS 
    {
        // 无权限
        NoAuth = 0;
        // 普通成员
        NormalMember = 1;
        // 管理员
        Manager = 2;
        // 馆长
        Librarian = 3;
    }
}

// 管理员信息(包含馆长)
message LibararyManagerInfo
{
    // 管理员id
    uint64 UserId = 1;
}

// 当 ReturnBackCount == BorrowCount时表示还完
message BorrowBookInfo 
{
    // book id
    uint64 BookId = 1;
    // isbn码
    string IsbnCode = 2;
    // 借阅数量
    sint32 BorrowCount = 3;
    // 借阅时间
    sint64 BorrowTime = 4;
    // 预计归还时间
    sint64 PlanGiveBackTime = 5;
    // 实际归还时间
    sint64 RealGiveBackTime = 6;
    // 已还数量
    uint64 ReturnBackCount = 7;
    // 子单号(当前借的书的单号)
    uint64 SubOrderId = 8;
}

// 订单状态
message BorrowOrderState
{
    enum ENUMS 
    {
        // 订单生成待管理员确认
        WAITING_MANAGER_CONFIRM = 0;

        // 订单管理员确认并出库图书
        ORDER_CONFIRM = 1;

        // 订单已出库等待领取
        WAIT_USER_RECEIVE = 2;

        // 用户已领取等待归还
        WAIT_USER_RETURN_BACK = 3;

        // 用户已归还所有图书
        USER_RETURN_BACK_ALL_BOOKS = 4;

        // 取消订单(需要填写原因, 当用户领取后不可取消订单只能归还, 还没领取的才可取消订单)
        CANCEL_ORDER = 5;

        // 已归还
        RETURN_BAKCK = 6;
    }
}

// 借还订单信息
message BorrowOrderInfo
{
    // 订单号
    uint64 OrderId = 1;
    // 借的书
    repeated BorrowBookInfo BorrowBookList = 2;
    // 订单创建时间
    uint64 CreateOrderTime = 3;
    // 订单状态 BorrowOrderState
    sint32 OrderState = 4;
    // 取消原因
    string CancelReason = 5;
}

// 会员信息(包括管理员等)
message MemberInfo 
{
    // user id
    uint64 UserId = 1;
    // 角色 RoleType
    sint32 Role = 2;
    // 会员昵称
    string Nickname = 3;
    // 当前借阅图书列表 只有有权限的人才会看到订单详情, 其他人只能看自己的
    repeated BorrowOrderInfo BorrowList = 4;
    // 锁定操作超时时间
    sint64 LockTimestampMs = 5;

    oneof MemberBindPhone
    {
        uint64 BindPhone = 6;
    }
}

message VariantParamType
{
    enum ENUMS
    {
        // 未知
        UNKNOWN = 0;
        // 数值
        NUM = 1;
        // 字符串
        STRING = 2;
    }
}

// 可变参数
message VariantParam
{
    // 参数类型 VariantParamType
    sint32 ParamType = 1;
    // 参数值
    oneof ParamValue
    {
        sint64 Number = 2;
        string Str = 3;
    }
}

message OperationType
{
    enum ENUMS
    {
        // 未知
        UNKNOWN = 0;
        
    }
}

// 操作日志
message OperationLogInfo
{
    sint32 OpType = 1;
    uint64 OpUserId = 2;
    string OpNickname = 3;
    sint32 Role = 4;
    sint64 OpTimeMs = 5;
    repeated VariantParam Params = 6;
}

message LibraryInfo 
{
    // 唯一id
    uint64 Id = 1;
    // 图书馆名
    string Name = 2;
    // 图书馆地址
    string Address = 3;
    // 图书馆经营时间
    string OpenTime = 4;
    // 图书馆联系电话
    string TelphoneNumber = 5;
    // 馆长id
    uint64 LibrarianUserId = 6;
    // 馆长名
    string LibrarianUserNickname = 7;
    // 管理员列表
    repeated LibararyManagerInfo ManagerInfoList = 8;
    // 会员列表
    repeated MemberInfo MemberList = 9;
    // 书不直接推送详情下去 TODO:
    repeated BookInfo BookList = 10;
    // 只保留一年的操作日志
    repeated OperationLogInfo LogInfoList = 11;
}

// 玩家的图书馆数据
message UserLibraryInfo 
{
    // 图书馆id
    uint64 LibraryId = 1;
}

// 图书馆预览数据
message LibraryPreviewInfo
{
    // 图书馆id
    uint64 Id = 1;
    // 图书馆名
    string Name = 2;
    // 馆长id
    uint64 LibrarianUserId = 3;
    // 馆长昵称
    string LibrarianNickname = 4;
}

// 关键词
message KeyWordsField
{
 repeated string KeyWords = 1;
}

// 截图
message SnapshotField
{
 repeated string Snapshots = 1;
}